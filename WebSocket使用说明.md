# WebSocket 实时数据测试使用说明

## 概述

本项目提供了一个完整的WebSocket实时数据传输测试案例，包括WebSocket服务器和客户端测试页面。

## 功能特点

### WebSocket服务器 (`websocket-server.js`)
- 模拟实时设备数据推送
- 支持多客户端连接
- 每2秒自动推送更新数据
- 支持ping/pong心跳检测
- 优雅关闭处理

### WebSocket客户端 (`WebSocketTest.vue`)
- 实时连接状态显示
- 设备参数实时更新展示
- 连接统计信息（连接时长、消息数量等）
- 详细的消息日志记录
- 手动连接/断开控制

## 使用步骤

### 1. 启动WebSocket服务器

```bash
# 在项目根目录执行
npm run ws-server
```

服务器将在 `ws://localhost:8080` 启动。

### 2. 启动前端开发服务器

```bash
# 在另一个终端窗口执行
npm run dev
```

前端服务器将在 `http://localhost:5173` 启动。

### 3. 访问WebSocket测试页面

1. 打开浏览器访问 `http://localhost:5173`
2. 点击导航栏中的 "WebSocket测试" 按钮
3. 在测试页面点击 "连接WebSocket" 按钮
4. 观察实时数据更新效果

## 测试功能

### 连接管理
- **连接状态指示器**：显示当前连接状态（未连接/连接中/已连接）
- **连接按钮**：手动控制WebSocket连接和断开
- **连接统计**：显示连接时长、接收消息数量、最后更新时间

### 实时数据展示
- **设备卡片**：展示多个模拟设备的实时参数
- **参数更新**：每2秒自动更新设备参数值
- **状态显示**：显示设备运行状态和最后更新时间

### 消息日志
- **实时日志**：记录所有WebSocket消息交互
- **消息分类**：不同类型消息用不同颜色标识
- **时间戳**：每条消息都有精确的时间记录

## 性能特点

### 数据传输优化
- **JSON格式**：使用轻量级JSON格式传输数据
- **增量更新**：只传输变化的数据
- **压缩传输**：WebSocket自动处理数据压缩

### 前端性能优化
- **响应式更新**：使用Vue3响应式系统高效更新UI
- **防抖处理**：避免频繁的DOM操作
- **内存管理**：限制日志条数，防止内存泄漏

### 错误处理
- **连接重试**：自动处理连接断开情况
- **错误日志**：详细记录连接和数据错误
- **优雅降级**：连接失败时提供友好提示

## 扩展建议

### 生产环境优化
1. **认证机制**：添加WebSocket连接认证
2. **数据验证**：增强服务端数据验证
3. **负载均衡**：支持多服务器实例
4. **监控告警**：添加连接状态监控

### 功能扩展
1. **订阅机制**：支持按设备ID订阅特定数据
2. **历史数据**：集成历史数据查询功能
3. **图表展示**：添加实时数据图表
4. **告警推送**：支持异常数据实时告警

## 技术栈

- **后端**：Node.js + ws库
- **前端**：Vue 3 + Composition API
- **通信协议**：WebSocket
- **数据格式**：JSON

## 注意事项

1. **端口冲突**：确保8080端口未被占用
2. **浏览器支持**：现代浏览器都支持WebSocket
3. **网络环境**：本地测试无需考虑防火墙问题
4. **资源清理**：页面关闭时会自动断开WebSocket连接

## 故障排除

### 常见问题

1. **连接失败**
   - 检查WebSocket服务器是否正常启动
   - 确认端口8080未被占用
   - 查看浏览器控制台错误信息

2. **数据不更新**
   - 检查WebSocket连接状态
   - 查看消息日志是否有数据接收
   - 确认服务器端数据推送正常

3. **性能问题**
   - 监控内存使用情况
   - 检查消息日志条数是否过多
   - 观察CPU使用率

通过这个WebSocket测试案例，您可以深入了解WebSocket在实时数据传输中的应用，为实际项目开发提供参考。